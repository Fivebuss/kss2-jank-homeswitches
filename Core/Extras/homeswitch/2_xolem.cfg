// Half-broken HomeWorldName-based homeswitch
// In theory this approach should be much, much better than renaming and moving things around. However, it is not without its MAJOR downsides, alongside the usual problems of homeswitches
// Set inside KSS2Settings.cfg 'homeSwitch = Xolem' to use, set it to False to remove

// !!!!!!!!!! VERY IMPORTANT
// Regarding the camera displacement bug: It seems that a save and unsave inside an active game session is required. 
// If we do not do this, (Ex: Load into tracking station then out again) theres a 50/50 chance severe problems will occur. Its basically gambling
// This issue is *not* fixable by me
// !!!!!!!!!!

// WE want Xolem so il do it poorly. Literally just steal Alvas and modify some SpaceCenter things. Thats it. Hard work already done. (I hope)

@Kopernicus_config:HAS[@KSS2_Settings:HAS[#homeSwitch[Xolem]]]:BEFORE[KSS2]
{
    HomeWorldName = Xolem // Much better than PostOrbit
    KSCLightsAlwaysOn = True // Creepy
}

// We are disabling ondemand to help with the flashing orbit lines bug, and because its a switched homeworld, to attempt to curb trackingStation issues
@Kopernicus:HAS[@KSS2_Settings:HAS[#homeSwitch[Xolem]]]:AFTER[KSS2]
{
    @Body[Xolem]
    {
        @ScaledVersion
        {
            @Material
            {
                texture = KSS2/SystemKormin/PluginData/Xolem_Color1.dds
                normals = KSS2/SystemKormin/PluginData/Xolem_Normal.dds
            }
            !OnDemand {}
        }
    }
}

@Kopernicus:HAS[@KSS2_Settings:HAS[#homeSwitch[Xolem]]]:AFTER[KSS2]
{
    removeLaunchSites = Desert_Launch_Site,Desert_Airfield,Desert_GroundObjects,Woomerang_Launch_Site,Woomerang_GroundObjects,Island_Airfield 
    Body[Kerbin]
    {
        @PQS
        {
            !Mods[MapDecalTangent,KSC] {}
        }
        // Attempt to strip SpaceCenter node from kerbin
        !SpaceCenter {}
    }

    // Xolem
    @Body[Xolem]
    {
        @Properties
        {
            isHomeWorld = true // Help KSC scene bug
        }

        // PQS nonsense
        @PQS
        {
            @Mods
            {
                MapDecalTangent
				{
					name = KSC
					absolute = True
					absoluteOffset = 1508
					angle = -90
					cullBlack = False
					DEBUG_HighlightInclusion = False
					heightMap = BUILTIN/ksc_decal_heightMap
					heightMapDeformity = 15
					removeScatter = False
					radius = 2700
                    position = 0.06345378, -0.00983320, -0.99793633

					useAlphaHeightSmoothing = True
					enabled = True
					order = 450
                }

                // Parallax mask
                !MapDecalVertexRemoveScatter:HAS[#name[ParallaxMaskKSC]]
                MapDecalVertexRemoveScatter
                {
                    name = ParallaxMaskKSC
                    colorMap = KSS2/Core/Extras/homeswitch/KSCD.dds
                    debugColorMap = KSS2/Core/Extras/homeswitch/KSCD.dds
                    angle = 2.5
                    radius = 1650
                    position = 0.0631000027,-0.00982999988,-0.997959971 //  −0.5629604469 , −86.3829653934
                    //Position
                    //{
                    //    latitude = -0.5629604469
                    //    longitude = -86.3829653934
                    //}

                    
                    BlockedScatters
                    {
                        name = XolemPlant
                        name = XolemTree1
                        name = XolemTree2
                        name = XolemTree3
                        name = MushroomClumpSingle
                        name = MushroomClump1
                        //name = XolemGrass
                        name = XolemFern
                        name = XolemShroom
                        name = XolemRingPlant

                    }
                    

                    debugShowDecal = False
                    order = 99999
                }


            }
        }
        
        // Oh boy
        SpaceCenter
        {
            latitude = -0.563409928975971
            longitude = -86.3617457363733
            repositionRadiusOffset = 1500
            reorientFinalAngle = -2.5            // Rotation alignment
            lodvisibleRangeMultiplier = 6
            decalLatitude = -0.563409928975971
            decalLongitude = -86.3617457363733

            // Grayish purple color #3f3041
            Material
            {
                grassColor = RGBA(63, 48, 65, 0.77)
            }
        }
    }
}

// Helps fix problems
@Kopernicus_config:HAS[@KSS2_Settings:HAS[#homeSwitch[Xolem]]]:AFTER[KOPERNICUS]
{
    %useManualMemoryManagement = True 
}
