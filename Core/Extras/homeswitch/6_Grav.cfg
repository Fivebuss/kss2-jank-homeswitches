// The best idea in the UNIVERSE
//-0.471878862592665
//-153.740472050957

@Kopernicus_config:HAS[@KSS2_Settings:HAS[#HomeSwitch[Grav]]]:BEFORE[KSS2]
{
    %HomeWorldName = Grav // Much better than PostOrbit
}

// We are disabling ondemand to fix the flashing orbit lines bug, and because its a switched homeworld, to attempt to curb trackingStation issues
@Kopernicus:HAS[@KSS2_Settings:HAS[#HomeSwitch[Grav]]]:AFTER[KSS2]
{
    @Body[Grav]
    {
        @ScaledVersion
        {
            @Material
            {
                texture = KSS2/SystemKerr/PluginData/Grav_Color1.dds
                normals = KSS2/SystemKerr/PluginData/Grav_Normal.dds
            }
            !OnDemand {}
		}
    }
}

@Kopernicus:HAS[@KSS2_Settings:HAS[#HomeSwitch[Grav]]]:AFTER[KSS2]
{
    removeLaunchSites = Desert_Launch_Site,Desert_Airfield,Desert_GroundObjects,Woomerang_Launch_Site,Woomerang_GroundObjects,Island_Airfield 
    Body[Kerbin]
    {
        @PQS
        {
            !Mods[MapDecalTangent,KSC] {}
        }
        // Attempt to strip SpaceCenter node from kerbin
        !SpaceCenter {}
    }

    // Grav
    @Body[Grav]
    {
		//cacheFile = KSS2/SystemKerr/_Cache/GravHS.bin
        @Properties
        {
            isHomeWorld = true // Help KSC scene bug
		}
		PostSpawnOrbit
		{
			referenceBody = #$../../Body[Grav]/Orbit/referenceBody$
		}
		//@Atmosphere				
		//{				
		//	%oxygen = True	
		//}

        // PQS nonsense, part 3
        @PQS
        {
            @Mods
            {
                MapDecalTangent
				{
					name = KSC
					absolute = True
					absoluteOffset = 48 // +8 from KSC altitude
					angle = 65
					cullBlack = False
					DEBUG_HighlightInclusion = False
					heightMap = BUILTIN/ksc_decal_heightMap
					heightMapDeformity = 15 // 15 works best for KSC
					removeScatter = False
					radius = 3100 // Radius of decal. Yet its a square. What?
                    position = -0.89639917, -0.00824359, -0.44239931 // OFfset to have KSC centered

					useAlphaHeightSmoothing = True
					enabled = True
					order = 450
                }

                // Parallax mask
                // Derived from xolem.cfg
                !MapDecalVertexRemoveScatter:HAS[#name[ParallaxMaskKSC]]
                MapDecalVertexRemoveScatter
                {
                    name = ParallaxMaskKSC
                    colorMap = KSS2/Core/Extras/HomeSwitch/KSCD.dds
                    debugColorMap = KSS2/Core/Extras/HomeSwitch/KSCD.dds
                    angle = -65 // Flip as the DDS file is flipped too
                    radius = 1650 // Same thing
                    position = -0.89604561, -0.00824359, -0.44311526 // Offset

                    
                    BlockedScatters
                    {
                        // Will do eventually
                        // Did do eventually
                        //name = SmallRocksVar1
                        name = SmallRocksVar2
                        name = MedRocksVar1
                        name = MedRocksVar2
                        name = MedRocksVar3
                        name = SteepRocksMed
                        name = SteepRocksSmall
                        name = VolcanicSpire
                        name = FlatBoulder

                    }
                    

                    debugShowDecal = False
                    order = 99999
                }

            }
        }
		
        // Oh boy
        SpaceCenter
        {
            // Positioned with a view of Kerr
            latitude = -0.471878862592665
			longitude = -153.69472050957
			decalLatitude = -0.471878862592665
			decalLongitude = -153.69472050957
            repositionRadiusOffset = 40 // Decal difference is +8
            reorientFinalAngle = 65           // Rotation aligned to 90deg
            lodvisibleRangeMult = 6

            // grass color #4C4A4A
            Material
            {
               grassColor = RGBA(76, 74, 74, 1)
            }
        }
    }
}

// Helps fix problems
@Kopernicus_config:HAS[@KSS2_Settings:HAS[#HomeSwitch[Grav]]]:AFTER[KOPERNICUS]
{
    %useManualMemoryManagement = True 
}